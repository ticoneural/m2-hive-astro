---
import { MapPin, ArrowUpRight } from 'lucide-astro';
import type { Product } from '../types';

interface Props {
	listing: Product;
}

const { listing } = Astro.props;

// Format price with currency
const priceFormatted = new Intl.NumberFormat("es-CR", {
	style: "currency",
	currency: listing.currency,
	maximumFractionDigits: 0,
}).format(listing.price);

// Explicit Type handling for Area
let areaName = "UbicaciÃ³n Premium";
if (listing.specifications?.location && typeof listing.specifications.location === 'string') {
    areaName = listing.specifications.location;
}
// Fallback logic for images
const coverImage = listing.thumbnail || (listing.images && listing.images.length > 0 ? listing.images[0] : "/placeholder.jpg");

---

<a
    href={`/propiedades/${listing.sku}`}
    class="group block bg-brand-surface border border-white/5 overflow-hidden relative hover:border-brand-accent/30 transition-all duration-500 hover:shadow-glass hover:-translate-y-1 block rounded-sm"
>
    <!-- Image Container -->
    <div class="relative aspect-[4/3] overflow-hidden">
        <div
            class="absolute inset-0 bg-brand-primary/20 z-10 group-hover:bg-transparent transition-all duration-500"
        ></div>
        <img
            src={coverImage}
            alt={listing.title}
            loading="lazy"
            class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700 ease-out-expo"
        />

        <!-- Badges -->
        <div class="absolute top-3 left-3 flex gap-2 z-20">
            {listing.category && (
                <div
                    class="bg-brand-accent text-brand-primary text-[10px] font-bold px-3 py-1 uppercase tracking-widest shadow-lg"
                >
                    {listing.category}
                </div>
            )}
        </div>

        <!-- Price Tag (Cinematic Overlay) -->
        <div
            class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-brand-primary/95 via-brand-primary/70 to-transparent p-5 pt-16 translate-y-2 group-hover:translate-y-0 transition-transform duration-500 z-20"
        >
            <div class="text-white font-serif font-bold text-xl tracking-wide">
                {priceFormatted}
            </div>
            <div
                class="flex items-center text-xs text-yellow-500/80 mt-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300 delay-100"
            >
                <MapPin size={12} class="mr-1 text-brand-accent" />
                {areaName}
            </div>
        </div>
    </div>

    <!-- Content (Minimalist Corporate) -->
    <div class="p-5 relative">
        <h3
            class="text-base font-serif text-brand-head line-clamp-2 leading-tight group-hover:text-brand-accent transition-colors duration-300"
        >
            {listing.title}
        </h3>
        
        <p class="text-xs text-brand-text/60 mt-2 uppercase tracking-wide font-bold">{listing.sku}</p>

        <div
            class="mt-4 flex justify-between items-center border-t border-white/5 pt-3"
        >
            <span class="text-[10px] uppercase tracking-widest text-brand-text"
                >Ver Detalles</span
            >
            <div
                class="bg-brand-primary p-2 text-brand-accent opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-x-3 group-hover:translate-x-0 rounded-full border border-brand-accent/20"
            >
                <ArrowUpRight size={16} />
            </div>
        </div>
    </div>
</a>
