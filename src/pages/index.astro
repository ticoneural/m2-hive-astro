---
import Layout from '../layouts/Layout.astro';
import ListingCard from '../components/ListingCard.astro';
import type { Product } from '../types';

let products: Product[] = [];
let error = null;

try {
  const response = await fetch('https://api-m2.agenticantnest.com/api/v1/products');
  if (!response.ok) {
    throw new Error(`Failed to fetch products: ${response.statusText}`);
  }
  const data = await response.json();
  // The Hive API v0.7.2 returns { count: X, data: [...] }
  products = data.data || [];
} catch (e) {
  console.error(e);
  error = "No se pudieron cargar las propiedades en este momento.";
}

const title = "M2 Real Estate - Propiedades Exclusivas";
---

<Layout title={title}>
	<!-- Cinematic Hero (Simplified) -->
	<section class="relative h-[60vh] flex items-center justify-center overflow-hidden bg-brand-primary">
		<div class="absolute inset-0 bg-black/60 z-10"></div>
		<img 
			src={products.length > 0 ? products[0].thumbnail : "/hero-bg.jpg"} 
			alt="Luxury Real Estate" 
			class="absolute inset-0 w-full h-full object-cover opacity-50 animate-scale-reveal"
		/>
		
		<div class="relative z-20 text-center px-4 animate-fade-in-up">
			<h1 class="font-serif text-5xl md:text-7xl text-white mb-6 drop-shadow-2xl">
				Exclusividad <span class="text-brand-accent">Redefinida</span>
			</h1>
			<p class="text-gray-300 text-lg md:text-xl max-w-2xl mx-auto font-light">
				Descubra una colección curada de propiedades de lujo en las ubicaciones más prestigiosas de Costa Rica.
			</p>
		</div>
	</section>

	<!-- Listings Grid -->
	<section class="py-20 bg-gray-50">
		<div class="container mx-auto px-6">
			<h2 class="font-serif text-3xl text-brand-surface mb-12 text-center">Colección Destacada</h2>
			
			{error ? (
				<div class="text-center py-12 bg-red-50 text-red-600 rounded-lg border border-red-200">
					<p>{error}</p>
				</div>
			) : (
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
					{products.map((product) => (
						<ListingCard listing={product} />
					))}
				</div>
			)}
		</div>
	</section>
</Layout>
