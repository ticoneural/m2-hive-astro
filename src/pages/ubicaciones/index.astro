---
import Layout from "../../layouts/Layout.astro";
import type { Category } from '../../types';

let categories: Category[] = [];
let error: string | null = null;

try {
    const response = await fetch(
        "https://api-m2.agenticantnest.com/api/v1/categories",
    );
    if (!response.ok) {
        throw new Error(`Failed to fetch categories: ${response.statusText}`);
    }
    const data = await response.json();
    categories = data || [];
} catch (e) {
    console.error(e);
    error = "No se pudieron cargar las zonas en este momento.";
}

const services = [
    {
        title: "Asesoría Técnica",
        desc: "Evaluamos el estado físico y potencial de cada propiedad para asegurar su inversión.",
        icon: "M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
    },
    {
        title: "Gestión Legal",
        desc: "Verificación de planos, escrituras y trámites ante el Registro Nacional para su tranquilidad.",
        icon: "M12 11c0 3.517-1.009 6.799-2.753 9.571m-2.753-15.706A8.005 8.005 0 0112 3c1.251 0 2.438.286 3.498.803M12 11c1.744 2.772 2.753 6.054 2.753 9.571m-2.753-9.571A8.005 8.005 0 0112 3m0 0V3m0 0v18"
    },
    {
        title: "Apoyo Financiero",
        desc: "Le conectamos con las mejores opciones de crédito bancario para agilizar su compra.",
        icon: "M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M12 15V7"
    }
];
---

<Layout title="Zonas y Servicios | M2 Real Estate">
    <div class="bg-white min-h-screen pt-48 pb-24 relative overflow-hidden">
        <!-- Abstract Decoration -->
        <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-brand-accent/5 rounded-full blur-[120px] -mr-64 -mt-64"></div>
        <div class="absolute bottom-0 left-0 w-[400px] h-[400px] bg-blue-50/50 rounded-full blur-[80px] -ml-32 -mb-32"></div>

        <div class="max-w-7xl mx-auto px-6 lg:px-8 relative z-10">
            <!-- Hero Section -->
            <div class="max-w-3xl mb-24 animate-fade-in">
                <span class="text-[10px] font-bold uppercase tracking-[0.5em] text-brand-accent mb-6 block drop-shadow-sm">
                    UBICACIONES ESTRATÉGICAS
                </span>
                <h1 class="text-5xl md:text-6xl font-serif text-[#0A192F] leading-tight mb-8">
                    Encuentre su lugar en <br/>
                    <span class="text-gray-300 italic">el Gran Área Metropolitana</span>
                </h1>
                <p class="text-xl text-slate-600 font-light leading-relaxed">
                    Gestionamos activos inmobiliarios con un enfoque en plusvalía, seguridad y calidad constructiva. Explore nuestras zonas activas de operación.
                </p>
            </div>

            <!-- Categories Grid -->
            <div class="mb-32">
                <h2 class="text-xs font-bold uppercase tracking-[0.3em] text-gray-400 mb-12 flex items-center gap-4">
                    Zonas con Disponibilidad Actual
                    <span class="h-[1px] bg-gray-100 flex-1"></span>
                </h2>

                {error ? (
                    <div class="text-center py-20 bg-red-50 text-red-600 rounded-sm border border-red-100">
                        <p class="font-serif italic font-light">{error}</p>
                    </div>
                ) : categories.length > 0 ? (
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {categories.map((cat) => (
                            <a
                                href={`/propiedades?category=${encodeURIComponent(cat.name)}`}
                                class="group bg-white p-10 border border-gray-100 hover:border-brand-accent/30 hover:shadow-2xl hover:shadow-brand-accent/10 transition-all duration-700 relative overflow-hidden"
                            >
                                <div class="absolute top-0 right-0 p-6 opacity-5 group-hover:opacity-20 transition-opacity">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                </div>
                                <h3 class="text-3xl font-serif text-[#0A192F] mb-4 group-hover:text-brand-accent transition-colors">
                                    {cat.name}
                                </h3>
                                <div class="flex items-center gap-3">
                                    <span class="w-1.5 h-1.5 rounded-full bg-brand-accent"></span>
                                    <p class="text-[10px] font-bold uppercase tracking-widest text-gray-400">
                                        {cat.count} {cat.count === 1 ? "Oportunidad" : "Propiedades"} Disponibles
                                    </p>
                                </div>
                            </a>
                        ))}

                        <!-- Placeholder for visual balance -->
                        <div class="bg-gray-50/50 p-10 border border-dashed border-gray-200 flex flex-col justify-center items-center text-center opacity-60">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">Próximamente</span>
                            <p class="text-xs font-serif italic text-gray-400">Expandiendo a nuevas regiones</p>
                        </div>
                    </div>
                ) : (
                    <div class="text-center py-20 border border-dashed border-gray-200 bg-gray-50/50">
                        <p class="text-gray-400 font-serif italic">Nuevas ubicaciones en etapa de auditoría.</p>
                    </div>
                )}
            </div>

            <!-- Value Proposition / Services Section -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-16 border-t border-gray-100 pt-32">
                <div class="lg:col-span-1">
                    <h2 class="text-xs font-bold uppercase tracking-[0.4em] text-brand-accent mb-6">M2 Real Estate</h2>
                    <h3 class="text-4xl font-serif text-[#0A192F] leading-tight mb-8">
                        ¿Cómo lo ayudamos <span class="text-gray-300 italic">a comprar?</span>
                    </h3>
                    <p class="text-gray-600 font-light leading-relaxed mb-10">
                        No somos solo una plataforma de anuncios. Somos su equipo de soporte en la toma de decisión más importante.
                    </p>
                    <a href="/contacto" class="inline-block text-[10px] font-bold uppercase tracking-[0.3em] text-[#0A192F] border-b-2 border-brand-accent pb-2 hover:text-brand-accent transition-all">
                        Solicitar Asesoría Personalizada
                    </a>
                </div>

                <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-16">
                    {services.map(service => (
                        <div class="group">
                            <div class="w-12 h-12 bg-[#0A192F] text-brand-accent flex items-center justify-center mb-6 group-hover:bg-brand-accent group-hover:text-white transition-all duration-500 shadow-xl shadow-blue-900/10">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d={service.icon} />
                                </svg>
                            </div>
                            <h4 class="text-xl font-bold text-[#0A192F] mb-4 uppercase tracking-wider">{service.title}</h4>
                            <p class="text-sm text-gray-500 leading-relaxed font-light">
                                {service.desc}
                            </p>
                        </div>
                    ))}
                    
                    <!-- Call to Action Card -->
                    <div class="bg-[#0A192F] p-8 md:p-10 flex flex-col justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-brand-accent/5 opacity-20"></div>
                        <h4 class="text-white text-xl font-serif italic mb-4 relative z-10">Venda su propiedad</h4>
                        <p class="text-gray-400 text-xs leading-relaxed mb-6 relative z-10 font-light">
                            ¿Busca colocar su activo en el mercado? Nuestro equipo se encarga de la promoción estratégica.
                        </p>
                        <a href="/contacto" class="text-brand-accent text-[10px] font-bold uppercase tracking-widest relative z-10 hover:text-white transition-colors">
                            Listar mi propiedad →
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</Layout>
